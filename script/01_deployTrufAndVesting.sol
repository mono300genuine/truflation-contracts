// SPDX-License-Identifier: UNLICENSED
pragma solidity 0.8.19;

import "forge-std/Script.sol";
import "../src/token/TruflationToken.sol";
import "../src/token/TrufVesting.sol";
import "../src/token/VotingEscrowTruf.sol";
import "../src/staking/VirtualStakingRewards.sol";

contract DeployTokenAndVesting is Script {
    using stdJson for string;

    TruflationToken public tfiToken;
    TrufVesting public vesting;
    VotingEscrowTruf public veTRUF;
    VirtualStakingRewards public tfiStakingRewards;
    uint256[] emissions;
    uint256[] teamEmissions;
    uint256[] advisorEmissions;
    uint256[] ecosystemEmissions;
    uint256[] productEmissions;
    uint256[] liquidityEmissions;
    uint256[] stakingRewardsEmissions;
    uint256[] preseedRound;
    uint256[] seedRound;
    uint256[] privateRound;
    uint256[] private2Round;

    function setUp() public {}

    function run() public {
        uint256 privateKey = vm.envUint("PRIVATE_KEY");

        vm.startBroadcast(privateKey);

        tfiToken = new TruflationToken();

        uint64 tgeTime = 1707921601;
        vesting = new TrufVesting(tfiToken, tgeTime);
        tfiToken.approve(address(vesting), type(uint256).max);
        tfiStakingRewards = new VirtualStakingRewards(vm.addr(privateKey), address(tfiToken));
        veTRUF = new VotingEscrowTruf(address(tfiToken), address(vesting), 1 hours, address(tfiStakingRewards));
        tfiStakingRewards.setOperator(address(veTRUF));
        vesting.setVeTruf(address(veTRUF));

        tfiStakingRewards.setRewardsDuration(30 days);
        tfiToken.transfer(address(tfiStakingRewards), 100_000e18);
        tfiStakingRewards.notifyRewardAmount(100_000e18);
        
        vesting.setVestingCategory(type(uint256).max, "Team & Recruitment", 130_000_000e18, false);
        vesting.setVestingCategory(type(uint256).max, "Advisors", 40_000_000e18, false);
        vesting.setVestingCategory(type(uint256).max, "Ecosystem Community", 160_000_000e18, true);
        vesting.setVestingCategory(type(uint256).max, "Product Development", 100_000_000e18, true);
        vesting.setVestingCategory(type(uint256).max, "Liquidity", 120_000_000e18, true);
        vesting.setVestingCategory(type(uint256).max, "Staking Rewards", 200_000_000e18, true);
        vesting.setVestingCategory(type(uint256).max, "Preseed Round", 34_300_000e18, false);
        vesting.setVestingCategory(type(uint256).max, "Seed Round", 78_200_000e18, false);
        vesting.setVestingCategory(type(uint256).max, "Private", 107_500_000e18, false);
        vesting.setVestingCategory(type(uint256).max, "Private2", 30_000_000e18, false);

        // create emissions
        getTeamEmission();
        getAdvisorEmission();
        getEcosystemEmissions();
        getProductEmission();
        getLiquidityEmission();
        getStakingRewardsEmission();
        getPreseedRoundEmission();
        getSeedRoundEmission();
        getPrivateEmission();
        getPrivate2Emission();

        vesting.setEmissionSchedule(0, teamEmissions);
        vesting.setEmissionSchedule(1, advisorEmissions);
        vesting.setEmissionSchedule(2, ecosystemEmissions);
        vesting.setEmissionSchedule(3, productEmissions);
        vesting.setEmissionSchedule(4, liquidityEmissions);
        vesting.setEmissionSchedule(5, stakingRewardsEmissions);
        vesting.setEmissionSchedule(6, preseedRound);
        vesting.setEmissionSchedule(7, seedRound);
        vesting.setEmissionSchedule(8, privateRound);
        vesting.setEmissionSchedule(9, private2Round);

        vesting.setAdmin(0x3dacA259E0911BB1B2844DA7b661b6C0E23E113f, true);
        TrufVesting.VestingInfo memory vestInfo = TrufVesting.VestingInfo(
            0,
            0,
            1,
            31536000,
            3600
        );
        TrufVesting.VestingInfo memory vestInfo2 = TrufVesting.VestingInfo(
            1000,
            600,
            0,
            31536000,
            600
        );
        vesting.setVestingInfo(0, type(uint256).max, vestInfo);
        vesting.setVestingInfo(1, type(uint256).max, vestInfo);
        vesting.setVestingInfo(2, type(uint256).max, vestInfo);
        vesting.setVestingInfo(0, type(uint256).max, vestInfo2);
        vesting.setVestingInfo(1, type(uint256).max, vestInfo2);
        vesting.setVestingInfo(2, type(uint256).max, vestInfo2);

        vesting.setUserVesting(0, 0, 0x3dacA259E0911BB1B2844DA7b661b6C0E23E113f, 0, 50e18);
        vesting.setUserVesting(0, 1, 0x3dacA259E0911BB1B2844DA7b661b6C0E23E113f, 0, 50e18);
        vesting.setUserVesting(1, 0, 0x3dacA259E0911BB1B2844DA7b661b6C0E23E113f, 0, 50e18);
        vesting.setUserVesting(1, 1, 0x3dacA259E0911BB1B2844DA7b661b6C0E23E113f, 0, 50e18);
        vesting.setUserVesting(2, 0, 0x3dacA259E0911BB1B2844DA7b661b6C0E23E113f, 0, 50e18);
        vesting.setUserVesting(2, 1, 0x3dacA259E0911BB1B2844DA7b661b6C0E23E113f, 0, 50e18);
        vm.stopBroadcast();
    }

    function getTeamEmission() internal {
        teamEmissions = [uint256(0), 0, 0, 0, 0, 0, 0, 0, 0, 2407407e18, 4814815e18, 7222222e18, 9629630e18, 12037037e18, 14444444e18, 16851852e18, 19259259e18, 21666667e18, 24074074e18, 26481481e18, 28888889e18, 31296296e18, 33703704e18, 36111111e18, 38518519e18, 40925926e18, 43333333e18, 45740741e18, 48148148e18, 50555556e18, 52962963e18, 55370370e18, 57777778e18, 60185185e18, 62592593e18, 65000000e18, 67407407e18, 69814815e18, 72222222e18, 74629630e18, 77037037e18, 79444444e18, 81851852e18, 84259259e18, 86666667e18, 89074074e18, 91481481e18, 93888889e18, 96296296e18, 98703704e18, 101111111e18, 103518519e18, 105925926e18, 108333333e18, 110740741e18, 113148148e18, 115555556e18, 117962963e18, 120370370e18, 122777778e18, 125185185e18, 127592593e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18, 130000000e18];
    }

    function getAdvisorEmission() internal {
        advisorEmissions = [0, 0, 0, 0, 0, 0, 0, 0, 0, 833333e18, 1666667e18, 2500000e18, 3333333e18, 4166667e18, 5000000e18, 5833333e18, 6666667e18, 7500000e18, 8333333e18, 9166667e18, 10000000e18, 10833333e18, 11666667e18, 12500000e18, 13333333e18, 14166667e18, 15000000e18, 15833333e18, 16666667e18, 17500000e18, 18333333e18, 19166667e18, 20000000e18, 20833333e18, 21666667e18, 22500000e18, 23333333e18, 24166667e18, 25000000e18, 25833333e18, 26666667e18, 27500000e18, 28333333e18, 29166667e18, 30000000e18, 30833333e18, 31666667e18, 32500000e18, 33333333e18, 34166667e18, 35000000e18, 35833333e18, 36666667e18, 37500000e18, 38333333e18, 39166667e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18, 40000000e18];
    }

    function getEcosystemEmissions() internal {
        ecosystemEmissions = [0, 0, 0, 16000000e18, 17515789e18, 19031579e18, 20547368e18, 22063158e18, 23578947e18, 25094737e18, 26610526e18, 28126316e18, 29642105e18, 31157895e18, 32673684e18, 34189474e18, 35705263e18, 37221053e18, 38736842e18, 40252632e18, 41768421e18, 43284211e18, 44800000e18, 46315789e18, 47831579e18, 49347368e18, 50863158e18, 52378947e18, 53894737e18, 55410526e18, 56926316e18, 58442105e18, 59957895e18, 61473684e18, 62989474e18, 64505263e18, 66021053e18, 67536842e18, 69052632e18, 70568421e18, 72084211e18, 73600000e18, 75115789e18, 76631579e18, 78147368e18, 79663158e18, 81178947e18, 82694737e18, 84210526e18, 85726316e18, 87242105e18, 88757895e18, 90273684e18, 91789474e18, 93305263e18, 94821053e18, 96336842e18, 97852632e18, 99368421e18, 100884211e18, 102400000e18, 103915789e18, 105431579e18, 106947368e18, 108463158e18, 109978947e18, 111494737e18, 113010526e18, 114526316e18, 116042105e18, 117557895e18, 119073684e18, 120589474e18, 122105263e18, 123621053e18, 125136842e18, 126652632e18, 128168421e18, 129684211e18, 131200000e18, 132715789e18, 134231579e18, 135747368e18, 137263158e18, 138778947e18, 140294737e18, 141810526e18, 143326316e18, 144842105e18, 146357895e18, 147873684e18, 149389474e18, 150905263e18, 152421053e18, 153936842e18, 155452632e18, 156968421e18, 158484211e18, 160000000e18];
    }

    function getProductEmission() internal {
        productEmissions = [0, 0, 0, 5000000e18, 5000000e18, 5000000e18, 5000000e18, 5000000e18, 5000000e18, 5000000e18, 5000000e18, 5000000e18, 5000000e18, 5000000e18, 5000000e18, 6130952e18, 7261905e18, 8392857e18, 9523810e18, 10654762e18, 11785714e18, 12916667e18, 14047619e18, 15178571e18, 16309524e18, 17440476e18, 18571429e18, 19702381e18, 20833333e18, 21964286e18, 23095238e18, 24226190e18, 25357143e18, 26488095e18, 27619048e18, 28750000e18, 29880952e18, 31011905e18, 32142857e18, 33273810e18, 34404762e18, 35535714e18, 36666667e18, 37797619e18, 38928571e18, 40059524e18, 41190476e18, 42321429e18, 43452381e18, 44583333e18, 45714286e18, 46845238e18, 47976190e18, 49107143e18, 50238095e18, 51369048e18, 52500000e18, 53630952e18, 54761905e18, 55892857e18, 57023810e18, 58154762e18, 59285714e18, 60416667e18, 61547619e18, 62678571e18, 63809524e18, 64940476e18, 66071429e18, 67202381e18, 68333333e18, 69464286e18, 70595238e18, 71726190e18, 72857143e18, 73988095e18, 75119048e18, 76250000e18, 77380952e18, 78511905e18, 79642857e18, 80773810e18, 81904762e18, 83035714e18, 84166667e18, 85297619e18, 86428571e18, 87559524e18, 88690476e18, 89821429e18, 90952381e18, 92083333e18, 93214286e18, 94345238e18, 95476190e18, 96607143e18, 97738095e18, 98869048e18, 100000000e18];
    }

    function getLiquidityEmission() internal {
        liquidityEmissions = [0, 0, 0, 60000000e18, 60631579e18, 61263158e18, 61894737e18, 62526316e18, 63157895e18, 63789474e18, 64421053e18, 65052632e18, 65684211e18, 66315789e18, 66947368e18, 67578947e18, 68210526e18, 68842105e18, 69473684e18, 70105263e18, 70736842e18, 71368421e18, 72000000e18, 72631579e18, 73263158e18, 73894737e18, 74526316e18, 75157895e18, 75789474e18, 76421053e18, 77052632e18, 77684211e18, 78315789e18, 78947368e18, 79578947e18, 80210526e18, 80842105e18, 81473684e18, 82105263e18, 82736842e18, 83368421e18, 84000000e18, 84631579e18, 85263158e18, 85894737e18, 86526316e18, 87157895e18, 87789474e18, 88421053e18, 89052632e18, 89684211e18, 90315789e18, 90947368e18, 91578947e18, 92210526e18, 92842105e18, 93473684e18, 94105263e18, 94736842e18, 95368421e18, 96000000e18, 96631579e18, 97263158e18, 97894737e18, 98526316e18, 99157895e18, 99789474e18, 100421053e18, 101052632e18, 101684211e18, 102315789e18, 102947368e18, 103578947e18, 104210526e18, 104842105e18, 105473684e18, 106105263e18, 106736842e18, 107368421e18, 108000000e18, 108631579e18, 109263158e18, 109894737e18, 110526316e18, 111157895e18, 111789474e18, 112421053e18, 113052632e18, 113684211e18, 114315789e18, 114947368e18, 115578947e18, 116210526e18, 116842105e18, 117473684e18, 118105263e18, 118736842e18, 119368421e18, 120000000e18];
    }
    
    function getStakingRewardsEmission() internal {
        stakingRewardsEmissions = [0, 0, 0, 0, 2105263e18, 4210526e18, 6315789e18, 8421053e18, 10526316e18, 12631579e18, 14736842e18, 16842105e18, 18947368e18, 21052632e18, 23157895e18, 25263158e18, 27368421e18, 29473684e18, 31578947e18, 33684211e18, 35789474e18, 37894737e18, 40000000e18, 42105263e18, 44210526e18, 46315789e18, 48421053e18, 50526316e18, 52631579e18, 54736842e18, 56842105e18, 58947368e18, 61052632e18, 63157895e18, 65263158e18, 67368421e18, 69473684e18, 71578947e18, 73684211e18, 75789474e18, 77894737e18, 80000000e18, 82105263e18, 84210526e18, 86315789e18, 88421053e18, 90526316e18, 92631579e18, 94736842e18, 96842105e18, 98947368e18, 101052632e18, 103157895e18, 105263158e18, 107368421e18, 109473684e18, 111578947e18, 113684211e18, 115789474e18, 117894737e18, 120000000e18, 122105263e18, 124210526e18, 126315789e18, 128421053e18, 130526316e18, 132631579e18, 134736842e18, 136842105e18, 138947368e18, 141052632e18, 143157895e18, 145263158e18, 147368421e18, 149473684e18, 151578947e18, 153684211e18, 155789474e18, 157894737e18, 160000000e18, 162105263e18, 164210526e18, 166315789e18, 168421053e18, 170526316e18, 172631579e18, 174736842e18, 176842105e18, 178947368e18, 181052632e18, 183157895e18, 185263158e18, 187368421e18, 189473684e18, 191578947e18, 193684211e18, 195789474e18, 197894737e18, 200000000e18];
    }

    function getPreseedRoundEmission() internal {
        preseedRound = [0, 0, 0, 1715000e18, 3072708e18, 4430417e18, 5788125e18, 7145833e18, 8503542e18, 9861250e18, 11218958e18, 12576667e18, 13934375e18, 15292083e18, 16649792e18, 18007500e18, 19365208e18, 20722917e18, 22080625e18, 23438333e18, 24796042e18, 26153750e18, 27511458e18, 28869167e18, 30226875e18, 31584583e18, 32942292e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18, 34300000e18];
    }

    function getSeedRoundEmission() internal {
        seedRound = [0, 0, 0, 3910000e18, 7005417e18, 10100833e18, 13196250e18, 16291667e18, 19387083e18, 22482500e18, 25577917e18, 28673333e18, 31768750e18, 34864167e18, 37959583e18, 41055000e18, 44150417e18, 47245833e18, 50341250e18, 53436667e18, 56532083e18, 59627500e18, 62722917e18, 65818333e18, 68913750e18, 72009167e18, 75104583e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18, 78200000e18];
    }

    function getPrivateEmission() internal {
        privateRound = [0, 0, 0, 5375000e18, 9630208e18, 13885417e18, 18140625e18, 22395833e18, 26651042e18, 30906250e18, 35161458e18, 39416667e18, 43671875e18, 47927083e18, 52182292e18, 56437500e18, 60692708e18, 64947917e18, 69203125e18, 73458333e18, 77713542e18, 81968750e18, 86223958e18, 90479167e18, 94734375e18, 98989583e18, 103244792e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18, 107500000e18];
    }

    function getPrivate2Emission() internal {
        private2Round = [0, 0, 0, 1500000e18, 2687500e18, 3875000e18, 5062500e18, 6250000e18, 7437500e18, 8625000e18, 9812500e18, 11000000e18, 12187500e18, 13375000e18, 14562500e18, 15750000e18, 16937500e18, 18125000e18, 19312500e18, 20500000e18, 21687500e18, 22875000e18, 24062500e18, 25250000e18, 26437500e18, 27625000e18, 28812500e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18, 30000000e18];
    }
}
